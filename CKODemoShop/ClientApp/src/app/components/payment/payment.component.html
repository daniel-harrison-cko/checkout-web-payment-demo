<mat-vertical-stepper [linear]="isLinear" #stepper>
  <mat-step [stepControl]="customerFormGroup">
    <form [formGroup]="customerFormGroup">
      <ng-template matStepLabel>Fill out your name and email</ng-template>
      <mat-form-field>
        <input matInput placeholder="Full name" formControlName="name" required>
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="Email" formControlName="email" required>
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="addressFormGroup">
    <form [formGroup]="addressFormGroup">
      <ng-template matStepLabel>Fill out your address</ng-template>
      <mat-form-field>
        <input matInput placeholder="Address" formControlName="address_line1" required>
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="Still Address" formControlName="address_line2">
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="City" formControlName="city" required>
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="State" formControlName="state" required>
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="Postcode" formControlName="zip" required>
      </mat-form-field><br />
      <mat-form-field>
        <input matInput placeholder="Country" formControlName="country" required>
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext (click)="createCustomer()">Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step>
    <form [formGroup]="paymentFormGroup">
      <ng-template matStepLabel>Verify&nbsp;&amp;&nbsp;Pay</ng-template>
      <app-verify-and-pay [customer]="customer"></app-verify-and-pay>
      <mat-divider></mat-divider>
      <div class="payment-setup">
        <mat-radio-group class="example-radio-group" formControlName="payment_method" required>
          <mat-radio-button class="example-radio-button" *ngFor="let paymentMethod of paymentMethods" [value]="paymentMethod" (click)="invokePaymentMethod(paymentMethod)">
            {{paymentMethod.name}}
          </mat-radio-button>
        </mat-radio-group>
        <div formArrayName="payment_configurators">
          <mat-form-field *ngFor="let payment_configurator of payment_configurators.controls; let i=index">
            <mat-select placeholder="Select your Bank" [formControlName]="i" required>
              <mat-option>--</mat-option>
              <mat-option *ngFor="let bank of banks" [value]="bank.value">
                {{bank.key}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="payment_configurator.hasError('required')">Please select your bank for payment with {{selectedPaymentMethod?.name}}.</mat-error>
          </mat-form-field>
        </div>        
      </div>      
      <mat-divider></mat-divider>
      <mat-checkbox class="gtc-checkbox" formControlName="gtc" required>{{gtcDisclaimer.i_have_read_and_agree}} <a href="{{gtcDisclaimer.g_t_c_uri}}" target="_blank">{{gtcDisclaimer.g_t_c}}</a>.<br />{{gtcDisclaimer.i_have_verified_and_want_to_pay}}{{selectedPaymentMethod?.name ? ' via ' + selectedPaymentMethod?.name : ''}}.</mat-checkbox>
      <div>
        <button mat-flat-button color="accent" [disabled]="paymentFormGroup.invalid || !agreesWithGtc" (click)="makePayment()">Pay Now</button>
      </div>
    </form>
  </mat-step>
</mat-vertical-stepper>
